{{- if and (eq .chezmoi.os "linux") (not (env "CI")) -}}
#!/bin/bash
set -euo pipefail
trap '' HUP

# Install build dependencies (needed for Homebrew on Linux)
if command -v apt &>/dev/null; then
  sudo apt update -y
  sudo apt install -y build-essential curl git
fi

# Install Homebrew if missing
if ! command -v brew &>/dev/null; then
  echo "Installing Homebrew..."
  NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

echo "Running brew bundle..."
brew bundle --file="{{ .chezmoi.sourceDir }}/Brewfile"
{{ end -}}
